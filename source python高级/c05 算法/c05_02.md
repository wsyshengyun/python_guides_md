# 5.2 递归算法：走楼梯会思考的题

![](http://image.iswbm.com/20200602135014.png)

今天来看一道有点意思的题目，有点意思的意思呢，不是说难，而是题目一想好像很难，但是如果找对了解决的思路，就能迎刃而解了。

问题是：
>假如这里有 n 个台阶，你可以选择每次完成一个台阶 或者 两个台阶，试问走完这 n 个台阶有多少种走法呢？

举个例子，如果有 7 个台阶，你可以选择 2 - 2 - 2 - 1 走完，也可以选择 2 - 1 - 1 - 1 - 2 走完。

这道题在群里，有人面试的时候被提问过，而正巧的是我在极客时间的 《数据结构与算法之美》 这个课程里学习过。

在往下看答案之前，你可以尝试自己思考如果是你自己来完成这道题目，会有什么思路？

接下来，我就分享一下这个题目的解法。

你可能不会想到这个题目居然可以用递归来解决吧？真的是思路清晰，简单又粗暴。

首先，你跨出的每个第一步，都只有两种选择，要么跨出一个台阶，要么跨出两个台阶。而每个下一步又是一个全新的开始，又面临着两种选择。你看，有点递归的味道了吧？每个过程都是重复的过程。

写递归函数，有两个最重要的点：

- `递推公式`：f(n) = f(n-1) + f(n-2)
- `终止条件`：f(1) = 1，f(2) = 2

用 Python 写一下：
```python
def calc_step_recursion(num):
    if num == 1:
        return 1
    if num == 2:
        return 2

    return calc_step_recursion(num - 1) + \
           calc_step_recursion(num - 2)
```

计算一下结果有多惊人
```
calc_step_recursion(10)
# 89

calc_step_recursion(20)
# 10946
```

如果今天只有这点内容那就太没有诚意了。

让我们尝试着对这个函数进行深度思考，就会发现这个函数会有一些问题。

首先，第一个问题是，这个递归写得虽然简洁，但是却有大量的重复计算。

比如，

```shell
f(5) = f(4) + f(3) 
     = f(3) + f(2) + f(3) 
     = f(2) + f(1) + f(2) + f(2) + f(1)
```

这里面，f(2) 就要运算 3 次，f(1) 要运算 2 次。

当我们的 n 为一个比较大的数时，这个运算过程会浪费很多的时间。

正好之前在看 《流畅的Python》 这本书的时候，学习到了一个非常好用的内置装饰器（`lru_cache`）。它可以将这些函数的运行结果保存下来（其实就是缓存），避免传入重复参数造成重复计算。
```python
import functools

@functools.lru_cache()
def calc_step_recursion(num):
    if num == 1:
        return 1
    if num == 2:
        return 2

    return calc_step_recursion(num - 1) + \
           calc_step_recursion(num - 2)
```

来看看加上这个装饰器后，性能到底提升了多少，这里用时间来衡量。
```
# 不加
calc_step_recursion(40)
# time：25.780471086502075 秒

# 不加
calc_step_recursion(40)
# time：0.0001678466796875 秒

```

第二个问题呢，使用递归的时候，我们都知道递归会出现堆栈溢出的风险。

为了避免这个问题，通常我们会将这个递归实现转换成循环迭代。

```
def calc_step_loop(num):
    step1 = 1
    step2 = 2
    for step in range(2, num):
        total = step1 + step2
        step2, step1 = total, step2
    return total
```

使用迭代循环的方式，不仅不会有重复计算的问题，而且又避免出现堆栈溢出的风险。可谓是一举两得。

同样地，也来看一下，它的运行时长，比使用递归的方法可好多了。
```
calc_step_loop（40）
# time：0.0000348091125488 秒
```

---

![](http://image.iswbm.com/20200607174235.png)
